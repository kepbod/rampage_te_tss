for i in ../all_TE_TSS_group/*gene_group.txt;do j=${${i/..\/all_TE_TSS_group\//}/_TE_gene_group.txt};perl -alne '$"="|";print "'$j'|@F[1..2,6,5]\t$F[-1]" if $F[-2] eq "TE_tss"' $i;done|perl -alne 'if($ARGV=~/genetype/){$a{$F[0]}=$F[1]}else{$a{None}="None";undef %t;map {$t{$a{$_}}++} split /,/,$F[-1];print "$_\t".join ",",keys %t}' ~zlab/genome/hg38/gencode.v29.genetype.txt $zlab/genome/hg38/additional_gene_name_genetype.txt - >! TE_TSS_region_gene_group_all.txt
for i in ../TE_TSS_group/*gene_group.txt;do j=${${i/..\/TE_TSS_group\//}/_TE_gene_group.txt};perl -alne '$"="|";print "'$j'|@F[1..2,6,5]\t$F[-1]" if $F[-2] eq "TE_tss"' $i;done|perl -alne 'if($ARGV=~/genetype/){$a{$F[0]}=$F[1]}else{$a{None}="None";undef %t;map {$t{$a{$_}}++} split /,/,$F[-1];print "$_\t".join ",",keys %t}' ~zlab/genome/hg38/gencode.v29.genetype.txt $zlab/genome/hg38/additional_gene_name_genetype.txt - >! TE_TSS_region_gene_group_high.txt
perl -alne 'if($#F==2){$a{$F[0]}=$F[1];$b{$F[0]}=$F[2]}else{$x1=join ",",map {$a{$_}} split /,/,$F[-1];undef %t1;map {$t1{$_}++} split /,/,$x1;$x2=join ",",map {$b{$_}} split /,/,$F[-1];undef %t2;map {$t2{$_}++} split /,/,$x2;print "$_\t".(join ",",keys %t1)."\t".(join ",",keys %t2)}' TE_TSS_region_gene_group_all.txt TE_TSS_cluster.txt >! TE_TSS_cluster_genetype.txt
perl -alne 'if($#F==2){$a{$F[0]}=$F[1];$b{$F[0]}=$F[2]}else{$x1=join ",",map {$a{$_}} split /,/,$F[-1];undef %t1;map {$t1{$_}++} split /,/,$x1;$x2=join ",",map {$b{$_}} split /,/,$F[-1];undef %t2;map {$t2{$_}++} split /,/,$x2;print "$_\t".(join ",",keys %t1)."\t".(join ",",keys %t2)}' TE_TSS_region_gene_group_all.txt high_TE_TSS_cluster.txt >! high_TE_TSS_cluster_genetype.txt
perl -alne 'if($F[-1]=~/protein_coding|IG.*_gene|TR.*_gene/){print "protein_coding"}elsif($F[-1]=~/pseudogene/){print "pseudogene"}elsif($F[-1]=~/lincRNA|3prime_overlapping_ncRNA|lncRNA/){print "lincRNA"}elsif($F[-1]=~/antisense/){print "antisense"}elsif($F[-1]=~/sense/){print "sense"}elsif($F[-1]=~/processed_transcript|TEC/){print "processed_transcript"}elsif($F[-1]=~/miRNA|snRNA|snoRNA|misc_RNA/){print "smRNA"}else{print $F[-1]}' TE_TSS_cluster_genetype.txt     |perl -alne 's/,//;print'|sort|uniq -c|sort -k 1,1nr
perl -alne 'if($F[-1]=~/protein_coding|IG.*_gene|TR.*_gene/){print "protein_coding"}elsif($F[-1]=~/pseudogene/){print "pseudogene"}elsif($F[-1]=~/lincRNA|3prime_overlapping_ncRNA|lncRNA/){print "lincRNA"}elsif($F[-1]=~/antisense/){print "antisense"}elsif($F[-1]=~/sense/){print "sense"}elsif($F[-1]=~/processed_transcript|TEC/){print "processed_transcript"}elsif($F[-1]=~/miRNA|snRNA|snoRNA|misc_RNA/){print "smRNA"}else{print $F[-1]}' high_TE_TSS_cluster_genetype.txt|perl -alne 's/,//;print'|sort|uniq -c|sort -k 1,1nr
perl -alne 'if($F[-1]=~/protein_coding|IG.*_gene|TR.*_gene/){$n=protein_coding}elsif($F[-1]=~/pseudogene/){$n=pseudogene}elsif($F[-1]=~/lincRNA|3prime_overlapping_ncRNA|lncRNA/){$n=lincRNA}elsif($F[-1]=~/antisense/){$n=antisense}elsif($F[-1]=~/sense/){$n="sense"}elsif($F[-1]=~/processed_transcript|TEC/){$n=processed_transcript}elsif($F[-1]=~/miRNA|snRNA|snoRNA|misc_RNA/){$n="smRNA"}else{$n=$F[-1]};$x=(split /\|/,$F[0])[0];$n=~s/,//;print "$x\t$n"' TE_TSS_region_gene_group_all.txt|sort|uniq -c|perl -ane '$a{$F[1]}{$F[2]}=$F[0];END{for$i(keys %a){print "$i";for$k("protein_coding", "pseudogene","lincRNA","antisense","sense","smRNA","processed_transcript","None"){$n=$a{$i}{$k}?$a{$i}{$k}:0;print "\t$n"};print "\n"}}'|pl -alne '$a=sum(@F[1..$#F]);@x=map {$_/$a*100} @F[1..$#F];$"="\t";print "$F[0]\t@x"'|sort -k 2,2g >! TE_TSS_region_gene_group_all_sample_labeled.txt
perl -alne 'if($F[-1]=~/protein_coding|IG.*_gene|TR.*_gene/){$n=protein_coding}elsif($F[-1]=~/pseudogene/){$n=pseudogene}elsif($F[-1]=~/lincRNA|3prime_overlapping_ncRNA|lncRNA/){$n=lincRNA}elsif($F[-1]=~/antisense/){$n=antisense}elsif($F[-1]=~/sense/){$n="sense"}elsif($F[-1]=~/processed_transcript|TEC/){$n=processed_transcript}elsif($F[-1]=~/miRNA|snRNA|snoRNA|misc_RNA/){$n="smRNA"}else{$n=$F[-1]};$x=(split /\|/,$F[0])[0];$n=~s/,//;print "$x\t$n"' TE_TSS_region_gene_group_high.txt|sort|uniq -c|perl -ane '$a{$F[1]}{$F[2]}=$F[0];END{for$i(keys %a){print "$i";for$k("protein_coding", "pseudogene","lincRNA","antisense","sense","smRNA","processed_transcript","None"){$n=$a{$i}{$k}?$a{$i}{$k}:0;print "\t$n"};print "\n"}}'|pl -alne '$a=sum(@F[1..$#F]);@x=map {$_/$a*100} @F[1..$#F];$"="\t";print "$F[0]\t@x"'|sort -k 2,2g >! TE_TSS_region_gene_group_high_sample_labeled.txt
